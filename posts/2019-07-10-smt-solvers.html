<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Shae Erisson's blog - SMT Solvers, Integer Linear Programming</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Shae Erisson's Blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>SMT Solvers, Integer Linear Programming</h1>

            <div class="info">
    Posted on July 10, 2019
    
</div>

<p>SMT is the biggest hammer. It can likely solve your problem but is rarely the best at solving problems in a particular domain.</p>
<p><img src="../images/witchcraftstaves.png" /></p>
<h1 id="game-addiction-write-code">Game addiction? Write code!</h1>
<p>I get addicted to games I play on my computer. The best fix I’ve found is to write code to solve the game once and for all.</p>
<h1 id="what-endless-sky">What? Endless Sky!</h1>
<p>I like to play this game <a href="https://endless-sky.github.io/">Endless Sky</a> and part of the games is exploring the starmap discovering different nations offering unique ships and ship components. Sometimes these new components have big benefits.</p>
<p>But hey, I’m at a programmer’s summer camp, and this looks like a constraint problem of some sort?
Given the list of components with their stats and a particular ship with a certain amount of space for engines and weapons, I should be able to calculate the optimal components, right?</p>
<p>For Endless Sky my question is, how can I maximize the value of thrust and turn with without exceeding a certain value for engine capacity?</p>
<p>But I have no idea how to do that! Even better, when I do it by hand, I keep finding novel solutions that are better than I thought was possible. How do I solve this once and forever?</p>
<p>Davean suggested I use into <a href="https://en.wikipedia.org/wiki/Integer_programming">integer</a> <a href="https://en.wikipedia.org/wiki/Integer_programming">linear</a> programming. I also investigated <a href="https://en.wikipedia.org/wiki/Mathematical_optimization">many other options</a> but finally decided to try an <a href="https://en.wikipedia.org/wiki/Satisfiability_modulo_theories">SMT solver</a>. That led to <strong>many</strong> days of reading and frustration, but finally VICTORY (well, sort of).</p>
<h1 id="go-fast-mostly">Go Fast, mostly</h1>
<p>Problem Statement: A ship can hold 210 units of engine capacity, and I want a balance of go fast and turn.</p>
<p>Happily, Endless Sky is open source, so I can get engine stats out of the <a href="https://github.com/endless-sky/endless-sky/tree/master/data">github data files</a>.</p>
<h1 id="smt-solvers">SMT Solvers</h1>
<p>The term SMT Solver is <a href="https://en.wikipedia.org/wiki/Satisfiability_modulo_theories">satisfiability modulo theories</a> which is a generalization <a href="https://en.wikipedia.org/wiki/Boolean_satisfiability_problem">boolean satisfiability</a> which is roughly “I have a boolean expression, is there any combination of inputs that will make its outputs true?</p>
<p>With help (and <a href="https://github.com/vaibhavsagar/advent-of-code/blob/master/2018/notebooks/Day23.ipynb">demo code</a>) from Vaibhav, I chose the <a href="http://hackage.haskell.org/package/sbv">sbv</a> Haskell library as a friendly wrapper for talking to SMT solvers.</p>
<p>I read the examples several times, and finally chose the <a href="https://github.com/LeventErkok/sbv/blob/master/Documentation/SBV/Examples/Optimization/VM.hs">virtual machine packing example</a> as a starting point. I didn’t get anywhere, after hours of trying to figure out how to express the problem.</p>
<p>After much skull sweat, how to express the idea came from <a href="https://vaibhavsagar.com/">Vaibhav</a> saying “Express it as a sum of Integers”. That is, a ship can have zero or more of each engine, and each of those integers has a particular value.
<a href="https://en.wikipedia.org/wiki/Integer_programming">Integer linear programming</a>! SMT solvers are much more general than ILP, but they can also do that, with their usual “can do, but won’t be fast” kind of approach.</p>
<p>A bunch of searching around turned up the <a href="https://rise4fun.com/Z3/tutorialcontent/optimization#h25">z3 optimization tutorial</a> which does the same thing, but then says “In this example, the boolean encoding is not really natural.”
They rewrite the problem with a bunch of Integer values, and that’s what I want!</p>
<h1 id="look-i-totally-zoned-out-can-you-repeat-all-that-stuff-in-much-smaller-words">Look, I totally zoned out, can you repeat all that stuff in much smaller words?</h1>
<p>Ok, let’s start much much smaller. The heavily commented Z3 tutorial example in this post has three Virtual Machines that can run on one or more of three host servers, let’s shrink that down a bunch.</p>
<p>The Haskell library I want to use has a port of the virtual machine packing example from the z3 tutorial.
I decided to cut that port down into the simplest thing that would demonstrate to me that this approach was going to work.</p>
<p>Something has a name, a cost, and a benefit. Given a limited budget, what’s the largest benefit I can get that fits?</p>
<p>In the code below, the somethings have names of x1, x2, x3; costs of 100, 50, and 15; and benefits of 83, 42, and 13.</p>
<p>There’s one function that calculates the cost, one for the benefit, a few extra constraints are thrown into the mix and everything is handed off to the z3 SMT solver.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Data.SBV</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- name, cost, benefit</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ot">things ::</span> [(<span class="dt">String</span>, <span class="dt">SInteger</span>, <span class="dt">SInteger</span>)]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>things <span class="ot">=</span> [ (<span class="st">&quot;x1&quot;</span>, <span class="dv">100</span>, <span class="dv">83</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  ,( <span class="st">&quot;x2&quot;</span>, <span class="dv">50</span>, <span class="dv">42</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  , (<span class="st">&quot;x3&quot;</span>, <span class="dv">15</span>, <span class="dv">13</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>getName (n,_,_) <span class="ot">=</span> n</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>getCost (_,c,_) <span class="ot">=</span> c</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>getBene (_,_,b) <span class="ot">=</span> b</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">-- calculate total *cost* for three inputs, using the list above named things</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">-- given 1,1,1 you get 1 * 100 + 1 * 50 + 1 * 15 = 165</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">-- given 0,1,0 you get 0 * 100 + 1 * 50 + 0 * 15 = 50</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ot">cost ::</span> [<span class="dt">SInteger</span>] <span class="ot">-&gt;</span> <span class="dt">SInteger</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>cost rs <span class="ot">=</span> <span class="fu">sum</span> <span class="op">$</span> <span class="fu">zipWith</span> (<span class="op">*</span>) (getCost <span class="op">&lt;$&gt;</span> things) rs</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">-- calculate total *benefit* for three inputs, using the list above named things</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">-- given 1,1,1 you get 1 * 83 + 1 * 42 + 1 * 13 = 138</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">-- given 0,1,0 you get 0 * 100 + 1 * 42 + 0 * 15 = 42</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="ot">benefit ::</span> [<span class="dt">SInteger</span>] <span class="ot">-&gt;</span> <span class="dt">SInteger</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>benefit rs <span class="ot">=</span> <span class="fu">sum</span> <span class="op">$</span> <span class="fu">zipWith</span> (<span class="op">*</span>) (getBene <span class="op">&lt;$&gt;</span> things) rs</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="ot">allocate ::</span> <span class="dt">Goal</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>allocate <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    names <span class="ot">&lt;-</span> sIntegers <span class="op">$</span> getName <span class="op">&lt;$&gt;</span> things <span class="co">-- create symbolic integers</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> capacity1 <span class="ot">=</span> cost names <span class="co">-- calculate the cost of three integer values</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a> benefit1 <span class="ot">=</span> benefit names <span class="co">-- calculate the benefit of three integer values</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapM_</span> (\x <span class="ot">-&gt;</span> constrain <span class="op">$</span> x <span class="op">.&gt;=</span> <span class="dv">0</span>) names <span class="co">-- each of the things must be zero or larger</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    constrain <span class="op">$</span> capacity1 <span class="op">.&lt;=</span> <span class="dv">100</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    constrain <span class="op">$</span> capacity1 <span class="op">.&gt;=</span> <span class="dv">0</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    constrain <span class="op">$</span> benefit1 <span class="op">.&gt;=</span> <span class="dv">0</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cost1 <span class="ot">=</span> <span class="fu">sum</span> names</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    constrain <span class="op">$</span> cost1 <span class="op">.&gt;=</span> <span class="dv">0</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    constrain <span class="op">$</span> cost1 <span class="op">.&lt;=</span> <span class="dv">100</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    maximize <span class="st">&quot;benefit - cost&quot;</span> (benefit1 <span class="op">-</span><span class="ot"> cost1 ::</span> <span class="dt">SInteger</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> optimize <span class="dt">Lexicographic</span> allocate</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span> res</span></code></pre></div>
<p>A tiny amount of time later, the results are in!</p>
<pre class="fundamental"><code>Optimal model:
  x1             =  0 :: Integer
  x2             =  2 :: Integer
  x3             =  0 :: Integer
  benefit - cost = 82 :: Integer
</code></pre>
<p>The best profit is 82, and comes from producing two of x2.</p>
<h1 id="ok-so-why-is-the-room-near-you-warmer-than-the-rest-of-the-building">Ok, so why is the room near you warmer than the rest of the building?</h1>
<p>Once I had the example above working, I was able to port it to exactly the problem I wanted to solve.
In the process of banging my head on this and complaining on various IRC channels I ran across <a href="https://github.com/peddie">Matt Peddie</a> in one of the Australian FP chats.
He confirmed that I was on the right track, and that this would likely suceed.</p>
<p>The code below has a list of all the engines in Endless Sky, as well as the amount of space required, and turn and thrust produced.</p>
<p>Originally I used floating point values directly from the data files, Matt suggested switching to the smallest integer type that wouldn’t overflow, as that would be solved in the smallest amount of time by z3.
So I multiplied thrust and turn values by ten, as the data files had at most one number after the decimal point.</p>
<p>Initial runs would sit and spin for ten or twenty minutes, and give no result. Matt suggested I comment out all but a few of the engine components to see if that gave results in a reasonable amount of time.</p>
<p>With eleven engines as input, a good solution took a fraction of a second! With nineteen engines, 7.3 seconds to find the best solution. Thirty one engines takes 24 seconds for the perfect solution. Forty two engines … I gave up after half an hour and killed it. There are seventy eight engines in the data file, I figured I’d uncomment them all and let it run overnight.</p>
<p>So here’s the code that’s been heating up my living area for the past fourteen hours:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">import</span>           <span class="dt">Data.SBV</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> <span class="kw">import</span>           <span class="dt">Data.SBV.Trans.Control</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>   res <span class="ot">&lt;-</span> optimize <span class="dt">Lexicographic</span> configure</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span> res</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="ot"> configure ::</span> <span class="dt">Goal</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a> configure <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>   engineNames <span class="ot">&lt;-</span> sInt32s <span class="op">$</span> getName <span class="op">&lt;$&gt;</span> engines</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>   <span class="kw">let</span> engineCost <span class="ot">=</span> costAmount engineNames</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>thrust <span class="ot">=</span> thrustAmount engineNames <span class="co">-- round down floats</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>turn <span class="ot">=</span> turnAmount engineNames <span class="co">-- round down floats</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>   constrain <span class="op">$</span> engineCost <span class="op">.&lt;=</span> <span class="dv">210</span> <span class="co">-- Kestrel + Weapons</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>   constrain <span class="op">$</span> engineCost <span class="op">.&gt;=</span> <span class="dv">0</span> <span class="co">-- can't be negative!</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>   constrain <span class="op">$</span> thrust <span class="op">.&gt;</span> <span class="dv">0</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>   constrain <span class="op">$</span> turn <span class="op">.&gt;</span> <span class="dv">0</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mapM_</span> (\x <span class="ot">-&gt;</span> constrain <span class="op">$</span> x <span class="op">.&gt;=</span> <span class="dv">0</span>) engineNames <span class="co">-- zero or more of each component</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mapM_</span> (\x <span class="ot">-&gt;</span> constrain <span class="op">$</span> x <span class="op">.&lt;=</span> <span class="dv">10</span>) engineNames <span class="co">-- I can't imagine more than ten of any component?</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>   maximize <span class="st">&quot;sum thrust and steering/36&quot;</span> ((thrust <span class="op">*</span> <span class="dv">36</span>) <span class="op">+</span><span class="ot"> turn ::</span> <span class="dt">SInt32</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="ot"> costAmount ::</span> [<span class="dt">SInt32</span>] <span class="ot">-&gt;</span> <span class="dt">SInt32</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a> costAmount es <span class="ot">=</span> <span class="fu">sum</span> <span class="op">$</span> <span class="fu">zipWith</span> (<span class="op">*</span>) (getSize <span class="op">&lt;$&gt;</span> engines) es</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="ot"> turnAmount ::</span> [<span class="dt">SInt32</span>] <span class="ot">-&gt;</span> <span class="dt">SInt32</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a> turnAmount es <span class="ot">=</span> <span class="fu">sum</span> <span class="op">$</span> <span class="fu">zipWith</span> (<span class="op">*</span>) (getTurn <span class="op">&lt;$&gt;</span> engines) es</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="ot"> thrustAmount ::</span> [<span class="dt">SInt32</span>] <span class="ot">-&gt;</span> <span class="dt">SInt32</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a> thrustAmount es <span class="ot">=</span> <span class="fu">sum</span> <span class="op">$</span> <span class="fu">zipWith</span> (<span class="op">*</span>) (getThrust <span class="op">&lt;$&gt;</span> engines) es</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a> getName (n,_,_,_) <span class="ot">=</span> n</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a> getSize (_,s,_,_) <span class="ot">=</span> s</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a> getThrust (_,_,th,_) <span class="ot">=</span> th</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a> getTurn (_,_,_,tu) <span class="ot">=</span> tu</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a> <span class="co">{- many engines, with different amounts of thrust and turning</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co"> a ship has limited space</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co"> What combination of engines fits into the ship, and gives the most thrust? -}</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a> <span class="co">-- values from https://github.com/endless-sky/endless-sky/blob/master/data/engines.txt</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a> <span class="co">-- name, size, thrust, turning</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a> <span class="co">-- this one multiplies all float values by 10 to make them integers</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="ot"> engines ::</span> [(<span class="dt">String</span>, <span class="dt">SInt32</span>, <span class="dt">SInt32</span>, <span class="dt">SInt32</span>)]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a> engines <span class="ot">=</span> [ (<span class="st">&quot;X1050&quot;</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">1100</span>) <span class="co">-- has both thrust and turning!</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X1200&quot;</span>, <span class="dv">12</span>, <span class="dv">0</span>, <span class="dv">1600</span>)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X1700&quot;</span>, <span class="dv">16</span>, <span class="dv">60</span>, <span class="dv">0</span>)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X2200&quot;</span>, <span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">3070</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X2700&quot;</span>, <span class="dv">27</span>, <span class="dv">115</span>, <span class="dv">0</span>)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X3200&quot;</span>, <span class="dv">35</span>, <span class="dv">0</span>, <span class="dv">5900</span>)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X3700&quot;</span>, <span class="dv">46</span>, <span class="dv">221</span>, <span class="dv">0</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X4200&quot;</span>, <span class="dv">59</span>, <span class="dv">0</span>, <span class="dv">11320</span>)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X4700&quot;</span>, <span class="dv">79</span>, <span class="dv">425</span>, <span class="dv">0</span>)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X5200&quot;</span>, <span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">21740</span>)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;X5700&quot;</span>, <span class="dv">134</span>, <span class="dv">815</span>, <span class="dv">0</span>)</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Chipmunk Thruster&quot;</span>, <span class="dv">20</span>, <span class="dv">96</span>, <span class="dv">0</span>)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Chipmunk Steering&quot;</span>, <span class="dv">15</span>, <span class="dv">0</span>, <span class="dv">2560</span>)</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Greyhound Steering&quot;</span>, <span class="dv">26</span>, <span class="dv">0</span>, <span class="dv">4920</span>)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Greyhound Thruster&quot;</span>, <span class="dv">34</span>, <span class="dv">184</span>, <span class="dv">0</span>)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Impala Steering&quot;</span>, <span class="dv">43</span>, <span class="dv">0</span>, <span class="dv">9440</span>)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Impala Thruster&quot;</span>, <span class="dv">58</span>, <span class="dv">354</span>, <span class="dv">0</span>)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Orca Steering&quot;</span>, <span class="dv">74</span>, <span class="dv">0</span>, <span class="dv">18120</span>)</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Orca Thruster&quot;</span>, <span class="dv">98</span>, <span class="dv">679</span>, <span class="dv">0</span>)</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Tyrant Steering&quot;</span>, <span class="dv">125</span>, <span class="dv">0</span>, <span class="dv">34790</span>)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Tyrant Thruster&quot;</span>, <span class="dv">167</span>, <span class="dv">1305</span>, <span class="dv">0</span>)</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A120 Thruster&quot;</span>, <span class="dv">22</span>, <span class="dv">154</span>, <span class="dv">0</span>)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A125 Steering&quot;</span>, <span class="dv">16</span>, <span class="dv">0</span>, <span class="dv">3920</span>)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A250 Thruster&quot;</span>, <span class="dv">34</span>, <span class="dv">273</span>, <span class="dv">0</span>)</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A255 Steering&quot;</span>, <span class="dv">25</span>, <span class="dv">0</span>, <span class="dv">6870</span>)</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A370 Thruster&quot;</span>, <span class="dv">53</span>, <span class="dv">476</span>, <span class="dv">0</span>)</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A375 Steering&quot;</span>, <span class="dv">38</span>, <span class="dv">0</span>, <span class="dv">11920</span>)</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A520 Thruster&quot;</span>, <span class="dv">82</span>, <span class="dv">819</span>, <span class="dv">0</span>)</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A525 Steering&quot;</span>, <span class="dv">60</span>, <span class="dv">0</span>, <span class="dv">20500</span>)</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A860 Thruster&quot;</span>, <span class="dv">127</span>, <span class="dv">1397</span>, <span class="dv">0</span>)</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;A865 Steering&quot;</span>, <span class="dv">92</span>, <span class="dv">0</span>, <span class="dv">35090</span>)</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Baellie&quot;</span>, <span class="dv">24</span>, <span class="dv">101</span>, <span class="dv">2500</span>) <span class="co">-- hai</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Basrem Thruster&quot;</span>, <span class="dv">18</span>, <span class="dv">132</span>, <span class="dv">0</span>)</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Benga Thruster&quot;</span>, <span class="dv">28</span>, <span class="dv">236</span>, <span class="dv">0</span>)</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Biroo Thruster&quot;</span>, <span class="dv">44</span>, <span class="dv">415</span>, <span class="dv">0</span>)</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Bondir Thruster&quot;</span>, <span class="dv">63</span>, <span class="dv">661</span>, <span class="dv">0</span>)</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Bufaer Thruster&quot;</span>, <span class="dv">104</span>, <span class="dv">1201</span>, <span class="dv">0</span>)</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Basrem Steering&quot;</span>, <span class="dv">12</span>, <span class="dv">0</span>, <span class="dv">3090</span>)</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Benga Steering&quot;</span>, <span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">5770</span>)</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Biroo Steering&quot;</span>, <span class="dv">32</span>, <span class="dv">0</span>, <span class="dv">10540</span>)</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Bondir Steering&quot;</span>, <span class="dv">49</span>, <span class="dv">0</span>, <span class="dv">17580</span>)</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Bufaer Steering&quot;</span>, <span class="dv">76</span>, <span class="dv">0</span>, <span class="dv">30430</span>)</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Coalition Large Steering&quot;</span>, <span class="dv">25</span>, <span class="dv">0</span>, <span class="dv">7119</span>) <span class="co">-- coalition</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Coalition Large Thruster&quot;</span>, <span class="dv">32</span>, <span class="dv">262</span>, <span class="dv">0</span>)</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Coalition Small Steering&quot;</span>, <span class="dv">7</span>, <span class="dv">0</span>, <span class="dv">1788</span>)</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Coalition Small Thruster&quot;</span>, <span class="dv">9</span>, <span class="dv">66</span>, <span class="dv">0</span>)</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Asteroid Steering&quot;</span>, <span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">2800</span>) <span class="co">-- Korath</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Asteroid Thruster&quot;</span>, <span class="dv">14</span>, <span class="dv">112</span>, <span class="dv">0</span>)</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Comet Steering&quot;</span>, <span class="dv">18</span>, <span class="dv">0</span>, <span class="dv">5688</span>)</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Comet Thruster&quot;</span>, <span class="dv">24</span>, <span class="dv">218</span>, <span class="dv">0</span>)</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Lunar Steering&quot;</span>, <span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">10560</span>)</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Lunar Thruster&quot;</span>, <span class="dv">40</span>, <span class="dv">412</span>, <span class="dv">0</span>)</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Planetary Steering&quot;</span>, <span class="dv">52</span>, <span class="dv">0</span>, <span class="dv">20696</span>)</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Planetary Thruster&quot;</span>, <span class="dv">69</span>, <span class="dv">800</span>, <span class="dv">0</span>)</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Stellar Steering&quot;</span>, <span class="dv">89</span>, <span class="dv">0</span>, <span class="dv">40050</span>)</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Korath Stellar Thruster&quot;</span>, <span class="dv">118</span>, <span class="dv">1534</span>, <span class="dv">0</span>)</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Pug Akfar Thruster&quot;</span>, <span class="dv">43</span>, <span class="dv">280</span>, <span class="dv">0</span>) <span class="co">-- pug</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Pug Akfar Steering&quot;</span>, <span class="dv">33</span>, <span class="dv">0</span>, <span class="dv">7500</span>)</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Pug Cormet Thruster&quot;</span>, <span class="dv">60</span>, <span class="dv">440</span>, <span class="dv">0</span>)</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Pug Comet Steering&quot;</span>, <span class="dv">46</span>, <span class="dv">0</span>, <span class="dv">11300</span>)</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Pug Lohmar Thruster&quot;</span>, <span class="dv">84</span>, <span class="dv">660</span>, <span class="dv">0</span>)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Pug Lohmar Steering&quot;</span>, <span class="dv">64</span>, <span class="dv">0</span>, <span class="dv">17000</span>)</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Quarg Medium Thruster&quot;</span>, <span class="dv">70</span>, <span class="dv">800</span>, <span class="dv">0</span>) <span class="co">-- quarg</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Quarg Medium Steering&quot;</span>, <span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">16000</span>)</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Crucible Thruster&quot;</span>, <span class="dv">20</span>, <span class="dv">180</span>, <span class="dv">0</span>) <span class="co">-- remnant</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Crucible Steering&quot;</span>, <span class="dv">14</span>, <span class="dv">0</span>, <span class="dv">4480</span>)</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Forge Thruster&quot;</span>, <span class="dv">39</span>, <span class="dv">370</span>, <span class="dv">0</span>)</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Forge Steering&quot;</span>, <span class="dv">28</span>, <span class="dv">0</span>, <span class="dv">9520</span>)</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Smelter Thruster&quot;</span>, <span class="dv">76</span>, <span class="dv">768</span>, <span class="dv">0</span>)</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Smelter Steering&quot;</span>, <span class="dv">55</span>, <span class="dv">0</span>, <span class="dv">19800</span>)</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Type 1 Radiant Thruster&quot;</span>, <span class="dv">12</span>, <span class="dv">66</span>, <span class="dv">0</span>) <span class="co">-- wanderer</span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Type 1 Radiant Steering&quot;</span>, <span class="dv">9</span>, <span class="dv">0</span>, <span class="dv">1728</span>)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Type 2 Radiant Thruster&quot;</span>, <span class="dv">27</span>, <span class="dv">176</span>, <span class="dv">0</span>)</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Type 2 Radiant Steering&quot;</span>, <span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">4540</span>)</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Type 3 Radiant Thruster&quot;</span>, <span class="dv">42</span>, <span class="dv">315</span>, <span class="dv">0</span>)</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Type 3 Radiant Steering&quot;</span>, <span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">7860</span>)</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Type 4 Radiant Thruster&quot;</span>, <span class="dv">64</span>, <span class="dv">552</span>, <span class="dv">0</span>)</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>    , (<span class="st">&quot;Type 4 Radiant Steering&quot;</span>, <span class="dv">47</span>, <span class="dv">0</span>, <span class="dv">13959</span>)</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<p>Given the progress above, I’m not terribly optimistic about how long z3 might take to solve this problem. Within my lifetime? Who knows?</p>
<p>Seems like davean was right, I should have used <a href="http://hackage.haskell.org/package/limp">limp</a> or other ILP solver.</p>
<p>Even so, my goal was to get started with SMT solvers and the sbv library.
The <a href="https://github.com/LeventErkok/sbv/tree/master/Documentation/SBV/Examples">sbv examples</a> show <strong>many</strong> more flavors of SMT-soluble problems that aren’t the optimization problems I described above, you may find something you like!
If you want non-interactive input from the helpful Matt Peddie, check out this <a href="https://www.youtube.com/watch?v=luaPkv5Rnpk">video of a talk</a> he gave to the Brisbane Functional Programming Group.</p>
<h1 id="appendix-many-helpful-comments-for-the-integer-example-in-the-z3-docs">Appendix: Many helpful comments for the Integer Example In The Z3 Docs</h1>
<p>I had a hard time reading the <a href="https://rise4fun.com/Z3/tutorial/guide">z3 tutorial</a> so I’ve added a bunch of comments to the optimization example that uses integer constraints, in hopes of easing comprehension for YOU should you decide to dig into this subject.</p>
<div class="sourceCode" id="cb4" data-org-language="lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">;; declare a cartesian product of host server and VM</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">;; three VMs x1, x2, x3 and three hosts y1, y2, y3</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>(declare-const x11 Int) <span class="co">; VM x1 might be on host y1</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>(declare-const x12 Int) <span class="co">; VM x1 might be on host y2</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>(declare-const x13 Int)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>(declare-const x21 Int) <span class="co">; VM x2 might be on host y1</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>(declare-const x22 Int)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>(declare-const x23 Int)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>(declare-const x31 Int)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>(declare-const x32 Int)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>(declare-const x33 Int) <span class="co">; VM x3 might be on host y3</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">;; declare the hosts as Int</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>(declare-const y1 Int)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>(declare-const y2 Int)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>(declare-const y3 Int)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">;; the solution grid cannot be negative</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">;; each combination of VM and host must be zero or more</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="kw">and</span> (<span class="op">&gt;=</span> x11 <span class="dv">0</span>) (<span class="op">&gt;=</span> x12 <span class="dv">0</span>) (<span class="op">&gt;=</span> x13 <span class="dv">0</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>      (<span class="op">&gt;=</span> x21 <span class="dv">0</span>) (<span class="op">&gt;=</span> x22 <span class="dv">0</span>) (<span class="op">&gt;=</span> x23 <span class="dv">0</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>      (<span class="op">&gt;=</span> x31 <span class="dv">0</span>) (<span class="op">&gt;=</span> x32 <span class="dv">0</span>) (<span class="op">&gt;=</span> x33 <span class="dv">0</span>)))</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">;; There's no more than one of each host server.</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="kw">and</span> (<span class="op">&lt;=</span> y1 <span class="dv">1</span>) (<span class="op">&lt;=</span> y2 <span class="dv">1</span>) (<span class="op">&lt;=</span> y3 <span class="dv">1</span>)))</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">;; the sum of the count of each VM on all hosts is one</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">;; that is, VM x1 must exist on one of the hosts, but no more or less than one</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="op">=</span> (<span class="op">+</span> x11 x12 x13) <span class="dv">1</span>)) <span class="co">; VM x1 must exist somewhere</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="op">=</span> (<span class="op">+</span> x21 x22 x23) <span class="dv">1</span>)) <span class="co">; VM x2 must exist somewhere</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="op">=</span> (<span class="op">+</span> x31 x32 x33) <span class="dv">1</span>)) <span class="co">; VM x3 must exist somewhere</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">;; if a VM is allocated to a host, that host must have a positive count</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="kw">and</span> (<span class="op">&gt;=</span> y1 x11) (<span class="op">&gt;=</span> y1 x21) (<span class="op">&gt;=</span> y1 x31)))</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="kw">and</span> (<span class="op">&gt;=</span> y2 x12) (<span class="op">&gt;=</span> y2 x22) (<span class="op">&gt;=</span> y2 x32)))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="kw">and</span> (<span class="op">&gt;=</span> y3 x13) (<span class="op">&gt;=</span> y3 x23) (<span class="op">&gt;=</span> y3 x33)))</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co">;; server y1 has 100 GB space, y2 has 75GB, y3 has 200GB</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co">;; VM x1 requires 100, x2 requires 50, x3 requires 15</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="op">&lt;=</span> (<span class="op">+</span> (<span class="op">*</span> <span class="dv">100</span> x11) (<span class="op">*</span> <span class="dv">50</span> x21) (<span class="op">*</span> <span class="dv">15</span> x31)) (<span class="op">*</span> <span class="dv">100</span> y1)))</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="op">&lt;=</span> (<span class="op">+</span> (<span class="op">*</span> <span class="dv">100</span> x12) (<span class="op">*</span> <span class="dv">50</span> x22) (<span class="op">*</span> <span class="dv">15</span> x32)) (<span class="op">*</span> <span class="dv">75</span> y2)))</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>(<span class="kw">assert</span> (<span class="op">&lt;=</span> (<span class="op">+</span> (<span class="op">*</span> <span class="dv">100</span> x13) (<span class="op">*</span> <span class="dv">50</span> x23) (<span class="op">*</span> <span class="dv">15</span> x33)) (<span class="op">*</span> <span class="dv">200</span> y3)))</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co">;; use the fewest hosts</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>(minimize (<span class="op">+</span> y1 y2 y3))</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co">;; server y1 costs $10 a day, y2 costs $5/day, y3 costs $20 a day</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co">;; minimize the daily host costs</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>(minimize (<span class="op">+</span> (<span class="op">*</span> <span class="dv">10</span> y1) (<span class="op">*</span> <span class="dv">5</span> y2) (<span class="op">*</span> <span class="dv">20</span> y3)))</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="co">;;(set-option :opt.priority pareto)</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co">;; is there a solution?</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>(check-sat)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="co">;; display the best solution</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>(get-model)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>(get-objectives)</span></code></pre></div>

        </div>
        <div id="footer">
	    <a href="feed.rss">RSS</a>
	    <a href="atom.xml">ATOM</a>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>

        </div>
    </body>
</html>
